<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.test.mybatis.dao.IReportDAO">

    <!-- 모임 신고 등록 -->
    <insert id="insertReport" parameterType="com.test.mybatis.dto.ReportDTO">
		INSERT INTO REPORT_GROUP (REPORT_GROUP_CODE, USER_CODE, GROUP_APPLY_CODE,
		REPORT_GROUP_TYPE, CREATED_DATE)
		VALUES (REPORT_GROUP_SEQ.NEXTVAL, #{userCode}, #{groupApplyCode},
		#{reportGroupType}, SYSDATE)
	</insert>
	
	<!-- 컨텐츠 신고 등록 -->
    <insert id="insertContent" parameterType="com.test.mybatis.dto.ReportDTO">
        INSERT INTO REPORT_POST 
        (REPORT_POST_CODE, JOIN_CODE, POST_CODE, REPORT_CONTENT_TYPE, CREATED_DATE)
        VALUES 
        (REPORT_POST_SEQ.NEXTVAL, #{joinCode}, #{postCode}, #{reportContentType}, SYSDATE)
    </insert> 

    <!-- 모임원 신고 등록 -->
    <insert id="insertMember" parameterType="com.test.mybatis.dto.ReportDTO">
        INSERT INTO REPORT_MEMBER 
        (REPORT_MEMBER_CODE, REPORTER_CODE, REPORTEE_CODE, REPORT_MEMBER_TYPE, CONTENT, CREATED_DATE)
        VALUES 
        (REPORT_MEMBER_SEQ.NEXTVAL, #{reporterCode}, #{reporteeCode}, #{reportMemberType}, #{content}, SYSDATE)
    </insert>    
    
    <select id="reportedListForManager" resultType="com.test.mybatis.dto.ReportDTO">
    	SELECT *
		FROM
		(
		    SELECT CONTENTTYPE AS CONTENT, TO_CHAR(REPORTDATE, 'YYYY-MM-DD') AS CREATEDDATE, REPORTTYPE, PROCESSTYPE
		    FROM REPORT_CONTENTS_LIST_VIEW
		    WHERE REPORTEE = #{userCode}
		    
		    UNION ALL
		    
		    SELECT 'MEMBER' AS CONTENT, TO_CHAR(RM.CREATED_DATE, 'YYYY-MM-DD') AS CREATEDDATE, RMT.TYPE AS REPORTTYPE, RMP.PROCESS_TYPE AS PROCESSTYPE
		    FROM REPORT_MEMBER RM
		    LEFT JOIN REPORT_MEMBER_PROCESS RMP ON RMP.REPORT_MEMBER_CODE = RM.REPORT_MEMBER_CODE
		    LEFT JOIN REPORT_MEMBER_TYPE RMT ON RMT.REPORT_MEMBER_TYPE = RM.REPORT_MEMBER_TYPE
		    WHERE REPORTEE_CODE = #{userCode}
		)
		ORDER BY TO_DATE(CREATEDDATE, 'YYYY-MM-DD') DESC
    </select>
    
    <select id="reportListForManager" resultType="com.test.mybatis.dto.ReportDTO">
		SELECT *
		FROM
		(
		    SELECT CONTENTTYPE AS CONTENT, TO_CHAR(REPORTDATE, 'YYYY-MM-DD') AS CREATEDDATE, REPORTEE AS REPORTEECODE, REPORTTYPE, PROCESSTYPE
		    FROM REPORT_CONTENTS_LIST_VIEW
		    WHERE REPORTER = #{userCode}
		    
		    UNION ALL
		    
		    SELECT 'MEMBER' AS CONTENT, TO_CHAR(RM.CREATED_DATE, 'YYYY-MM-DD') AS CREATEDDATE, REPORTEE_CODE AS REPORTEECODE,RMT.TYPE AS REPORTTYPE, RMP.PROCESS_TYPE AS PROCESSTYPE
		    FROM REPORT_MEMBER RM
		    LEFT JOIN REPORT_MEMBER_PROCESS RMP ON RMP.REPORT_MEMBER_CODE = RM.REPORT_MEMBER_CODE
		    LEFT JOIN REPORT_MEMBER_TYPE RMT ON RMT.REPORT_MEMBER_TYPE = RM.REPORT_MEMBER_TYPE
		    WHERE REPORTER_CODE = #{userCode}
		)
		ORDER BY TO_DATE(CREATEDDATE, 'YYYY-MM-DD') DESC
    </select>
    
</mapper>
